# ğŸš€ API Hub éƒ¨ç½²æŒ‡å—

## å¿«é€Ÿéƒ¨ç½²ï¼ˆæ¨èï¼‰

### 1. å‡†å¤‡å·¥ä½œ

ç¡®ä¿æœåŠ¡å™¨å·²å®‰è£…ï¼š
- Docker >= 20.10
- Docker Compose >= 1.29

### 2. å…‹éš†æˆ–æ›´æ–°ä»£ç 

```bash
# å¦‚æœå·²æœ‰é¡¹ç›®ï¼Œå…ˆæ›´æ–°
cd /var/www/html/api-hub
git pull

# å¦‚æœæ˜¯æ–°éƒ¨ç½²
git clone <your-repo-url> /var/www/html/api-hub
cd /var/www/html/api-hub
```

### 3. ä¸€é”®éƒ¨ç½²

```bash
./deploy.sh
```

éƒ¨ç½²è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
- âœ… åœæ­¢æ—§å®¹å™¨
- âœ… æ„å»ºæ–°é•œåƒï¼ˆå¤šé˜¶æ®µæ„å»ºï¼‰
- âœ… å¯åŠ¨æ–°å®¹å™¨
- âœ… å¥åº·æ£€æŸ¥

### 4. æ£€æŸ¥éƒ¨ç½²çŠ¶æ€

```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f api-hub

# æ£€æŸ¥å¥åº·çŠ¶æ€
curl http://localhost:9530/api/health
```

## ç«¯å£è¯´æ˜

- **9530**: åº”ç”¨æœåŠ¡ç«¯å£ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
- **4000**: æœ¬åœ°å¼€å‘ç«¯å£ï¼ˆnpm run devï¼‰

## é…ç½®è¯´æ˜

### Dockerfile ä¼˜åŒ–ç‚¹

1. **å¤šé˜¶æ®µæ„å»º**
   - Stage 1: å®‰è£…ä¾èµ–ï¼ˆdepsï¼‰
   - Stage 2: æ„å»ºåº”ç”¨ï¼ˆbuilderï¼‰
   - Stage 3: è¿è¡Œæ—¶é•œåƒï¼ˆrunnerï¼‰

2. **é•œåƒå¤§å°ä¼˜åŒ–**
   - ä½¿ç”¨ Alpine Linuxï¼ˆ~5MB åŸºç¡€é•œåƒï¼‰
   - Next.js standalone æ¨¡å¼
   - ä»…å¤åˆ¶å¿…è¦æ–‡ä»¶
   - æœ€ç»ˆé•œåƒçº¦ 150MB

3. **å®‰å…¨ä¸æ€§èƒ½**
   - Root ç”¨æˆ·è¿è¡Œï¼ˆå†…éƒ¨ç¯å¢ƒï¼‰
   - å¥åº·æ£€æŸ¥è‡ªåŠ¨é‡å¯
   - ç”Ÿäº§ç¯å¢ƒå˜é‡
   - ç¦ç”¨ Telemetry

### docker-compose.yml é…ç½®

```yaml
services:
  api-hub:
    ports:
      - "9530:9530"              # ç«¯å£æ˜ å°„
    environment:
      - NODE_ENV=production      # ç”Ÿäº§ç¯å¢ƒ
      - PORT=9530                # åº”ç”¨ç«¯å£
    restart: unless-stopped      # è‡ªåŠ¨é‡å¯
    healthcheck:                 # å¥åº·æ£€æŸ¥
      test: curl -f http://localhost:9530/api/health
      interval: 30s              # æ¯ 30 ç§’æ£€æŸ¥
      timeout: 10s               # è¶…æ—¶æ—¶é—´
      retries: 3                 # é‡è¯•æ¬¡æ•°
      start_period: 40s          # å¯åŠ¨ç­‰å¾…æ—¶é—´
```

## å¸¸è§é—®é¢˜

### 1. æ„å»ºå¤±è´¥ï¼šæ‰¾ä¸åˆ° public ç›®å½•

**è§£å†³æ–¹æ¡ˆ**ï¼šå·²ä¿®å¤ï¼Œé¡¹ç›®å·²åŒ…å« `public` ç›®å½•

### 2. ç«¯å£è¢«å ç”¨

```bash
# æŸ¥çœ‹å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -i:9530

# æˆ–ä½¿ç”¨ netstat
netstat -tulpn | grep 9530

# åœæ­¢å ç”¨çš„æœåŠ¡
docker-compose down
```

### 3. æ„å»ºç¼“å­˜é—®é¢˜

```bash
# æ¸…ç†ç¼“å­˜é‡æ–°æ„å»º
docker-compose build --no-cache
docker-compose up -d
```

### 4. æŸ¥çœ‹å®Œæ•´æ—¥å¿—

```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f api-hub

# æŸ¥çœ‹æœ€è¿‘ 100 è¡Œæ—¥å¿—
docker-compose logs --tail=100 api-hub
```

### 5. è¿›å…¥å®¹å™¨è°ƒè¯•

```bash
# ä»¥ root èº«ä»½è¿›å…¥å®¹å™¨
docker-compose exec api-hub sh

# æŸ¥çœ‹æ–‡ä»¶ç»“æ„
ls -la /app

# æŸ¥çœ‹è¿›ç¨‹
ps aux
```

## æ€§èƒ½ä¼˜åŒ–

### 1. é•œåƒç¼“å­˜

é¦–æ¬¡æ„å»ºè¾ƒæ…¢ï¼ˆçº¦ 2-3 åˆ†é’Ÿï¼‰ï¼Œåç»­æ„å»ºä¼šåˆ©ç”¨ç¼“å­˜ï¼Œä»…éœ€ 30 ç§’å·¦å³ã€‚

### 2. ä¾èµ–æ›´æ–°

ä»…å½“ `package.json` å˜åŒ–æ—¶æ‰ä¼šé‡æ–°å®‰è£…ä¾èµ–ï¼Œå…¶ä»–æƒ…å†µä½¿ç”¨ç¼“å­˜ã€‚

### 3. æ„å»ºé€Ÿåº¦å¯¹æ¯”

| æ„å»ºç±»å‹ | æ—¶é—´ | è¯´æ˜ |
|---------|------|------|
| é¦–æ¬¡æ„å»º | ~3åˆ†é’Ÿ | ä¸‹è½½ä¾èµ– + æ„å»º |
| ä»£ç å˜æ›´ | ~30ç§’ | ä»…é‡æ–°æ„å»º |
| ä¾èµ–å˜æ›´ | ~2åˆ†é’Ÿ | é‡æ–°å®‰è£…ä¾èµ– |
| æ— å˜æ›´ | ~5ç§’ | ä½¿ç”¨å®Œæ•´ç¼“å­˜ |

## ç¯å¢ƒå˜é‡é…ç½®ï¼ˆå¯é€‰ï¼‰

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
# Next.js é…ç½®
NODE_ENV=production
PORT=9530
HOSTNAME=0.0.0.0

# ä¼ä¸šä»£ç†ï¼ˆå¯é€‰ï¼‰
HTTPS_PROXY=http://proxy.company.com:8080
HTTP_PROXY=http://proxy.company.com:8080
NO_PROXY=localhost,127.0.0.1,.internal.com

# MCP é…ç½®ï¼ˆé¢„ç•™ï¼‰
MCP_API_KEY=your-api-key
MCP_ENDPOINT=https://mcp-api.example.com
```

ç„¶ååœ¨ `docker-compose.yml` ä¸­å¼•ç”¨ï¼š

```yaml
services:
  api-hub:
    env_file:
      - .env
```

## ç›‘æ§ä¸ç»´æŠ¤

### å¥åº·æ£€æŸ¥

åº”ç”¨å†…ç½®å¥åº·æ£€æŸ¥æ¥å£ï¼š`/api/health`

è¿”å›ç¤ºä¾‹ï¼š
```json
{
  "ok": true,
  "ts": 1730803200000
}
```

### è‡ªåŠ¨é‡å¯ç­–ç•¥

é…ç½®äº† `restart: unless-stopped`ï¼Œæ„å‘³ç€ï¼š
- âœ… å®¹å™¨å¼‚å¸¸é€€å‡ºæ—¶è‡ªåŠ¨é‡å¯
- âœ… æœåŠ¡å™¨é‡å¯åè‡ªåŠ¨å¯åŠ¨å®¹å™¨
- âœ… æ‰‹åŠ¨åœæ­¢å®¹å™¨åä¸ä¼šè‡ªåŠ¨é‡å¯

### æ—¥å¿—ç®¡ç†

Docker æ—¥å¿—é»˜è®¤æ— é™åˆ¶å¢é•¿ï¼Œå»ºè®®é…ç½®æ—¥å¿—è½®è½¬ï¼š

```yaml
services:
  api-hub:
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
```

## ç”Ÿäº§ç¯å¢ƒæ¸…å•

- [ ] ä»£ç å·²æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬
- [ ] Docker å’Œ Docker Compose ç‰ˆæœ¬ç¬¦åˆè¦æ±‚
- [ ] ç«¯å£ 9530 æœªè¢«å ç”¨
- [ ] æœåŠ¡å™¨æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´ï¼ˆè‡³å°‘ 2GBï¼‰
- [ ] é…ç½®äº†å¥åº·æ£€æŸ¥å’Œè‡ªåŠ¨é‡å¯
- [ ] æ—¥å¿—è½®è½¬å·²é…ç½®ï¼ˆå¯é€‰ï¼‰
- [ ] ç¯å¢ƒå˜é‡å·²æ­£ç¡®è®¾ç½®
- [ ] é˜²ç«å¢™è§„åˆ™å·²é…ç½®ï¼ˆå¦‚æœéœ€è¦å¤–ç½‘è®¿é—®ï¼‰

## å›æ»šæ–¹æ¡ˆ

å¦‚æœéƒ¨ç½²å‡ºç°é—®é¢˜ï¼Œå¯ä»¥å¿«é€Ÿå›æ»šï¼š

```bash
# 1. æŸ¥çœ‹ä¹‹å‰çš„é•œåƒ
docker images | grep api-hub

# 2. åœæ­¢å½“å‰å®¹å™¨
docker-compose down

# 3. ä½¿ç”¨æ—§ç‰ˆæœ¬é•œåƒå¯åŠ¨
docker run -d -p 9530:9530 \
  --name api-hub \
  --restart unless-stopped \
  api-hub:<æ—§ç‰ˆæœ¬æ ‡ç­¾>

# æˆ–å›é€€ä»£ç åé‡æ–°éƒ¨ç½²
git reset --hard <commit-hash>
./deploy.sh
```

## æ€§èƒ½ç›‘æ§ï¼ˆå¯é€‰ï¼‰

### ä½¿ç”¨ Docker Stats

```bash
# å®æ—¶ç›‘æ§å®¹å™¨èµ„æºä½¿ç”¨
docker stats api-hub

# è¾“å‡ºç¤ºä¾‹ï¼š
# CONTAINER   CPU %   MEM USAGE / LIMIT     MEM %   NET I/O
# api-hub     0.5%    150MiB / 2GiB        7.5%    1.2kB / 850B
```

### ä½¿ç”¨ Prometheusï¼ˆé«˜çº§ï¼‰

å¯ä»¥é›†æˆ Prometheus + Grafana è¿›è¡Œæ›´è¯¦ç»†çš„ç›‘æ§ã€‚

## æŠ€æœ¯æ”¯æŒ

é‡åˆ°é—®é¢˜ï¼Ÿ
1. æŸ¥çœ‹æ—¥å¿—ï¼š`docker-compose logs -f api-hub`
2. æ£€æŸ¥å¥åº·çŠ¶æ€ï¼š`curl http://localhost:9530/api/health`
3. è¿›å…¥å®¹å™¨è°ƒè¯•ï¼š`docker-compose exec api-hub sh`
4. æŸ¥çœ‹æœ¬æ–‡æ¡£çš„ã€Œå¸¸è§é—®é¢˜ã€éƒ¨åˆ†

---

**éƒ¨ç½²å®Œæˆåè®¿é—®**: http://your-server-ip:9530

